<#
.Synopsis
    Disable ActiveX controls per MSRC gidance
.DESCRIPTION
    This script is intended to mitigate MITRE CVE-2021-40444
    Reference: https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-40444

    Required Script Variable:
        Name: BlockActiveX
        Type: Dropdown
        Values: False (Default)
                True
.NOTES
    Version:        1.0
    Author:         jrdnr
    Creation Date:  08/09/2021
    Purpose/Change: Initial script development
#>

foreach ($i in 0..3) {
    $regK = "HKLM:\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\$i"
    if('False' -eq $BlockActiveX){
        Remove-Item -Path $regK
    } elseif (Test-Path -Path $regK){
        $regK
        Get-ItemProperty -Path $regK | Select-Object -Property '1001','1004'
        Set-ItemProperty -Path $regK -Name 1001 -Value 3
        Set-ItemProperty -Path $regK -Name 1004 -Value 3
    } else {
        Write-Warning "$regK Not Found"
        New-Item -Path $regK
        New-ItemProperty -Path $regK -Name 1001 -Value 3
        New-ItemProperty -Path $regK -Name 1004 -Value 3
    }
}
